#!/bin/bash
ln -sf /usr/share/zoneinfo/America/Los_Angeles /etc/localtime
hwclock --systohc
#uncomment "en_US.UTF-8 UTF-8" in /etc/locale.gen
sed -i -e 's/#en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/g' /etc/locale.gen
locale-gen
echo "LANG=en_US.UTF-8" >> /etc/locale.conf
echo "Input hostname:"
read hostname
echo $hostname >> /etc/hostname
echo -e 127.0.0.1	localhost::1		localhost127.0.1.1	$hostname.localdomain	$hostname >> /etc/hosts
sed -i -e 's/#Color/Color/g' /etc/pacman.conf
echo "Please set root password"
passwd
echo "Input username (no caps):"
read username
#User input
useradd -m $username
echo "Please set user password"
passwd $username
echo "Giving user root priveleges..."
#Do with visudo?
echo $username" ALL=(ALL) ALL" >> /etc/sudoers
echo "Installing paru..."
cd /home/$username
git clone https://aur.archlinux.org/paru.git
chown $username:$username paru/ -R
cd paru
#-u $username avoids makepkg erroring when run as root
sudo -u $username makepkg -si
cd
#Remove install folder
rm -rf paru/
echo "Setting shell to zsh..."
chsh -s /usr/bin/zsh $username                                                                                                                                                                                                   
chsh -s /usr/bin/zsh
echo "Install AUR packages? This will take a while. [y/n]"
read choice
if [[ $choice == y* ]]; then
    #currently broken, need to find out how to run it as a different user
    echo "Installing AUR packages..."
    sudo -u $username paru -S starship bitwarden zoom-system-qt visual-studio-code-bin lightcord-bin downgrade bitwarden-cli plex-media-player nerd-fonts-complete signal-cli bluej intellij-idea-ultimate-edition-jre libreoffice-extension-languagetool gcalcli rslsync cordless-bin tldr-go-client-git microsoft-edge-dev-bin
    echo "Setting zsh theme... "
    echo eval "$(starship init zsh)" >> .zshrc
    exit
else
    echo "Skipping AUR packages..."
fi
echo "Adding aliases..."
#yay is the superior name
echo alias yay='paru'>>/home/$username/.zshrc
echo alias yay='paru'>>/home/$username/.bashrc
#make sudo work with aliases
echo alias sudo='sudo '>>/home/$username/.zshrc
echo alias sudo='sudo '>>/home/$username/.bashrc
#command confirmation
echo alias rm='rm -i'>>/home/$username/.zshrc
echo alias rm='rm -i'>>/home/$username/.bashrc
echo alias mv='mv -i'>>/home/$username/.zshrc
echo alias mv='mv -i'>>/home/$username/.bashrc
echo alias cp='cp -i'>>/home/$username/.zshrc
echo alias cp='cp -i'>>/home/$username/.bashrc
echo "Enabling services..."
systemctl enable NetworkManager.service
systemctl enable sddm.service
echo "Done! Make sure to install a bootloader and intel/amducode depending on your system."